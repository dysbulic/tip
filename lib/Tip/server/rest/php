<?php
/**
 * Tip Server - Mediates access to a repository of document fragments
 * Author: Will Holcomb <will@dhappy.org>
 * Date: 11 December 2009
 * Version: http://tip.dhappy.org/server/rest/0.1/a

 # ToDo: Google's extended use of the term "beta" on gmail has likely
 # skewed public expectations of beta software. On tip beta release
 # page include a short video explaining that beta software is likely
 # to break and linking to http://help.dhappy.org.

 * This class is coupled with the XMLHTTP client to serve document
 * fragments and maintain the client's position in the server-side of
 * the state machine.
 */

/**
 * If no resource was requested, a directory listing should have been
 * generated by Apache.
 */

require_once(".../lib/Tip/src/php");


/*
 * Start by removing any routing information from the front of the string
 */
$baseURIs = array();
array_push($baseURIs, json_decode('{ "pattern" : "http://will.tip.dhappy.org/",    "replacement" : "/" }'));
array_push($baseURIs, json_decode('{ "pattern" : "http://localhost/",              "replacement" : "/" }'));
array_push($baseURIs, json_decode('{ "pattern" : "/~will/",                        "replacement" : "/" }'));
array_push($baseURIs, json_decode('{ "pattern" : "/projects/Tip/src/server/rest/", "replacement" : "/" }'));
array_push($baseURIs, json_decode('{ "pattern" : "index.php\\\\?" }'                                     ));
array_push($baseURIs, json_decode('{ "pattern" : "php\\\\?" }'                                           ));

// ToDo: add __toStrings

foreach($baseURIs as $baseURI) {
  $baseURI->subject = $uri;
  $baseURI->pattern = "|^" . $baseURI->pattern . "|";
 /** Not supported
  $uri = replace($baseURI)->subject;
   **/
  $ret = replace($baseURI);
  $uri = $ret->subject;
}

// If the resource is empty, handoff to the null agent
if($uri == "") { return require("agents/empty/php"); }



// First see if it is a file
if(file_exists("index.php")) {
  print "<h1>is a file</h1>";
}

print "<message>\n";

require('auth.php');

mysql_connect($host, $user, $pass, $database) or die("Failed to connect to database: " . $database);
?>
